---
title: "Теория вер-тей в R: генерация распределений"
output: 
  html_document:
    css: ../css/style.css
    toc: TRUE
    toc_float: TRUE
    toc_depth: 4
    highlight: pygments
editor_options: 
  chunk_output_type: console
---
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

Подгрузим пакет для рисования графиков, понадобится нам в дальнейшем для визуализации гистограмм и плотностей: 

```{r}
library("ggplot2")  # Пакет для красивых графиков 
```


Иногда для решения задач по теории вероятностей или исследования свойств статистических алгоритмов нужно сгенерировать случайную выборку из какого-нибудь распределения. Чтобы сварить в R любую случайную величину, нужно знать четыре буквы: r, d, p и q. 

Посмотрим как это работает на примере **нормального распределения**. Того самого распределения, плотность которого выглядит как-то вот так: 

$$
f(x) = \frac{1}{\sigma \sqrt{2 \pi}} \cdot  e^{-\frac{(x - \mu)^2}{2 \sigma^2}}
$$

* `rnorm` эта команда сгенерирует выборку из нормального распределения
* `dnorm` эта команда вычислит значение плотности в указанной точке
* `pnorm` эта команда находит вероятность 
* `qnorm` эта команда находит квантили 

Аналогично можно работать со многими другими распределениями. Нужно только загуглить названия этих распределений. Например, команда `rchisq` всё ещё генерирует выборку, но уже из распределения хи-квадрат. 


Сгенерируем случайную величину из нормального распределения с математическим ожиданием $5$ и дисперсией $9$. 

```{r}
# если дисперсия 9, то стандартное отклонение 3
x <- rnorm(100000, mean=5, sd=3)  
x[1:5]
```

Теперь мы можем посчитать выборочные характеристики для нашей случайной величины. 

```{r}
print(mean(x)) # среднее выборочное (при больших n похоже на математическое ожидание)
print(var(x)) # выборочная дисперсия
print(sd(x)) # выборочное стандартное отклонение
print(median(x)) # выборочная медиана)
```

Также мы можем построить гистограмму!

```{r}
qplot(x, bins=100) # гистограмма 
```

Построим функцию плотности

```{r}
x <- seq(-5, 15, by=0.01)
y <- dnorm(x, mean=5, sd=3)

qplot(x, y, geom="line")
```

Теперь попробуем поотвечать на конкретные вопросы. Например, найдём вероятность того, что нормально распределённая случайная величина с выбранными параметрами примет значение меньше $3$. 

$$ P(X < 3) = \int_{-\infty}^3 f(x)dx = F(3)$$

```{r}
pnorm(3, mean=5, sd=3)
```

А теперь попробуем найти вер-ть того, что случайная величина лежит в диапазоне от $4$ до $9$.

$$ P(4 < X < 9) = \int_4^9 f(x) dx = F(9) - F(4)$$

```{r}
pnorm(9, mean=5, sd=3) - pnorm(4, mean=5, sd=3)
```

Для полноты картины осталось только найти какой-нибудь квантиль! Не будем забывать о том, что квантиль уровня $\gamma$ это такое число $q$, что 

$$P(X < q) = \gamma$$
```{r}
qnorm(0.025, mean=0, sd=1)
```

Квантили довольно часто будут использоваться нами при проверке статистических гипотез, но об этом чуть позже... 

```{r}
x <- c(0.95, 0.975, 0.995)
qnorm(x, mean = 0, sd = 1)
```

## Зачем это надо? 

Чтобы решать реальные проблемы и делать это без взятия страшных интегралов на листочке! Например, оценим вероятность $P(X_1 + X_2 + X_3^2 > 5)$, где величины $X_i$ независимы и одинаково распределены $X_i \sim U[0;2]$:

```{r}
n_obs <- 10^6
x_1 <- runif(n_obs, min = 0, max = 2)
x_2 <- runif(n_obs, min = 0, max = 2)
x_3 <- runif(n_obs, min = 0, max = 2)

success <- x_1 + x_2 + x_3^2 > 5
sum(success) / n_obs
```

Также нужно понимать, что все, чем мы тут занимаемся и собираемся заниматься, возможно благодаря великим двум теоремам тервера: ЗБЧ и ЦПТ. Очень подробно о них мы поговорим на следующем занятии, а пока давайте поразвлекаемся со всякими генерациями в тетрадке с задачами.


